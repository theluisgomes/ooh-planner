<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OOH Planner - Planejadora de M√≠dia Out-of-Home</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Header com Total Global -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="logo.png" alt="Logo OOH Planner" class="logo-icon"
                        style="width: 50px; height: 50px; border-radius: 100%;">
                    <div>
                        <h1>O Botic√°rio</h1>
                        <p class="subtitle">OOH PLANNER - DATA-FLOW V2.1</p>
                    </div>
                </div>

                <!-- Buttons removed as per request -->
                <!-- <div class="header-actions">
                    <button class="btn btn-secondary" id="btnConfig">
                        ‚öôÔ∏è CONFIG
                    </button>
                    <button class="btn btn-primary" id="btnStore">
                        üíæ STORE ON BIGQUERY
                    </button>
                </div> -->

                <div class="header-actions">
                    <a href="history.html" class="btn btn-secondary"
                        style="padding: 0.5rem 1rem; font-size: 0.875rem; margin-right: 0.5rem; text-decoration: none; display: inline-flex; align-items: center;">
                        üìú Hist√≥rico
                    </a>
                    <button class="btn btn-secondary" id="btnSavePlan"
                        style="padding: 0.5rem 1rem; font-size: 0.875rem; margin-right: 0.5rem;">
                        üíæ Salvar Plano
                    </button>
                    <button class="btn btn-secondary" id="btnLogout" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        üö™ Sair
                    </button>
                    <!-- <button class="btn btn-secondary" id="btnConfig">‚öôÔ∏è CONFIG</button> -->
                    <!-- <button class="btn btn-primary" id="btnStore">üíæ STORE ON BIGQUERY</button> -->
                </div>

                <div class="total-card">
                    <div class="total-label">BUDGET L√çQUIDO ATUAL</div>
                    <div class="total-value" id="totalCard">R$ 0,00</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Blocos de M√≠dia -->
    <main class="main-content">
        <div class="container">
            <div id="mediaBlocks" class="media-blocks-grid">
                <!-- Os blocos ser√£o gerados dinamicamente via JS -->
            </div>

            <div class="actions-bar" style="text-align: center; margin: 2rem 0;">
                <button id="btnAddBlock" class="btn btn-primary" onclick="addBlock()">
                    + ADICIONAR RECORTE DE M√çDIA
                </button>
            </div>
        </div>
    </main>

    <!-- Tabela Consolidada -->
    <section class="consolidated-section">
        <div class="container">
            <div class="section-header">
                <h2>üìã Tabela Consolidada</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary" id="btnResetAll">üîÑ Reset Tudo</button>
                    <button class="btn btn-primary" id="btnStore">üíæ Store on BigQuery</button>
                    <button class="btn btn-primary" id="btnExport">üì• Exportar CSV</button>
                </div>
            </div>

            <div class="table-wrapper">
                <table class="consolidated-table" id="consolidatedTable">
                    <thead>
                        <tr>
                            <th>M√≠dia</th>
                            <th>UF</th>
                            <th>Pra√ßa</th>
                            <th>Taxonomia</th>
                            <th>Exibidores</th>
                            <th>Formato</th>
                            <th>Faces</th>
                            <th>Budget Input</th>
                            <th>Budget Usado</th>
                            <th>Ideal</th>
                            <th>Sobrando</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="consolidatedTableBody">
                        <tr class="empty-state">
                            <td colspan="12">Nenhuma m√≠dia configurada ainda</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Template do Bloco de M√≠dia -->
    <template id="mediaBlockTemplate">
        <div class="media-block">
            <div class="media-block-header">
                <div class="media-number">
                    <span class="number-badge">2</span>
                    <div>
                        <h3>RECORTE DE M√çDIA</h3>
                        <p class="config-label">CONFIGURA√á√ÉO T√âCNICA #02</p>
                    </div>
                </div>
                <div class="media-status">
                    <span class="status-badge inactive">INATIVO</span>
                    <button class="btn-icon btn-delete" title="Resetar bloco">üóëÔ∏è</button>
                </div>
            </div>

            <div class="media-block-content">
                <!-- CORE INPUTS (4 campos principais) -->
                <div class="core-inputs-section">
                    <h4 class="section-title">üìù Par√¢metros Principais</h4>
                    <div class="core-inputs-grid">
                        <div class="form-group">
                            <label>üí∞ BUDGET TOTAL (R$)</label>
                            <input type="number" class="form-control input-budget" placeholder="Ex: 50000" min="0"
                                step="1000">
                        </div>

                        <div class="form-group">
                            <label>üìÖ CICLO (semanas)</label>
                            <input type="number" class="form-control input-campaign-cycle" placeholder="Ex: 4" min="1"
                                step="1">
                        </div>

                        <div class="form-group">
                            <label>üè∑Ô∏è TAXONOMIA</label>
                            <select class="form-control input-taxonomia">
                                <option value="">Selecione...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>üìç PRA√áA</label>
                            <select class="form-control input-praca">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- IDEAL PLAN RECOMMENDATION (auto-generated) -->
                <div class="ideal-plan-section" style="display: none;">
                    <h4 class="section-title">üí° Plano Ideal Recomendado</h4>
                    <div class="ideal-plan-summary">
                        <div class="ideal-metric">
                            <span class="metric-label">Total de Faces:</span>
                            <span class="metric-value ideal-total-faces">--</span>
                        </div>
                        <div class="ideal-metric">
                            <span class="metric-label">Custo Total:</span>
                            <span class="metric-value ideal-total-cost">--</span>
                        </div>
                        <div class="ideal-metric">
                            <span class="metric-label">Exposi√ß√£o:</span>
                            <span class="metric-value ideal-total-exposure">--</span>
                        </div>
                    </div>
                    <div class="ideal-formats-grid">
                        <!-- Populated dynamically with format cards -->
                    </div>
                </div>

                <!-- MANUAL ADJUSTMENT SECTION -->
                <div class="manual-adjustment-section" style="display: none;">
                    <h4 class="section-title">‚úèÔ∏è Ajuste Manual (Realidade de Negocia√ß√£o)</h4>
                    <p class="section-description">Ajuste as quantidades conforme a disponibilidade real do fornecedor
                    </p>
                    <div class="manual-adjustment-grid">
                        <!-- Populated dynamically with editable inputs -->
                    </div>
                    <button class="btn btn-primary btn-generate-list" style="margin-top: 1rem;">
                        üìã Gerar Lista de Players
                    </button>
                </div>

                <!-- EFFICIENCY INDICATORS -->
                <div class="efficiency-section" style="display: none;">
                    <h4 class="section-title">üìä An√°lise de Efici√™ncia</h4>

                    <!-- Comparison Cards -->
                    <div class="efficiency-comparison">
                        <div class="efficiency-card">
                            <div class="efficiency-label">Plano Ideal</div>
                            <div class="efficiency-value ideal-efficiency-value">--</div>
                            <div class="efficiency-sublabel">exposi√ß√µes/R$</div>
                        </div>
                        <div class="efficiency-arrow">‚Üí</div>
                        <div class="efficiency-card">
                            <div class="efficiency-label">Plano Ajustado</div>
                            <div class="efficiency-value manual-efficiency-value">--</div>
                            <div class="efficiency-sublabel">exposi√ß√µes/R$</div>
                        </div>
                    </div>

                    <!-- Efficiency Sliders -->
                    <div class="efficiency-sliders-grid">
                        <!-- Efici√™ncia L√≠quida Slider -->
                        <div class="slider-card">
                            <div class="slider-header">
                                <span class="slider-title">EFICI√äNCIA L√çQUIDA</span>
                                <span class="slider-value ideal-efficiency-slider-value">--</span>
                            </div>
                            <div class="slider-track-container">
                                <div class="slider-labels">
                                    <span>INEFICIENTE</span>
                                    <span>EFICIENTE</span>
                                </div>
                                <div class="slider-track">
                                    <div class="slider-dashed-line"></div>
                                    <div class="slider-cursor baseline" style="left: 50%;"></div>
                                    <div class="slider-cursor current efficiency-cursor" style="left: 0%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- √çndice de Exposi√ß√£o Slider -->
                        <div class="slider-card">
                            <div class="slider-header">
                                <span class="slider-title">√çNDICE DE EXPOSI√á√ÉO</span>
                                <span class="slider-value exposure-slider-value">--</span>
                            </div>
                            <div class="slider-track-container">
                                <div class="slider-labels">
                                    <span>UNDER</span>
                                    <span>OVER</span>
                                </div>
                                <div class="slider-track">
                                    <div class="slider-dashed-line"></div>
                                    <div class="slider-cursor baseline" style="left: 50%;"></div>
                                    <div class="slider-cursor current exposure-cursor" style="left: 0%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Bar -->
                    <div class="efficiency-status-bar">
                        <div class="efficiency-bar">
                            <div class="efficiency-fill" style="width: 0%"></div>
                        </div>
                        <div class="efficiency-status">--</div>
                    </div>
                </div>

                <!-- PLAYER LIST (final output) -->
                <div class="player-list-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 class="section-title" style="margin: 0;">üìã Lista de Players e Formatos</h4>
                        <button class="btn btn-secondary btn-export-csv" style="font-size: 0.875rem;">
                            üì• Exportar CSV
                        </button>
                    </div>
                    <div class="player-table-wrapper">
                        <table class="player-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Pra√ßa</th>
                                    <th>UF</th>
                                    <th>Exibidores</th>
                                    <th>Formato</th>
                                    <th>Qtd Ideal</th>
                                    <th>Qtd Negociada</th>
                                    <th>Desconto %</th>
                                    <th>Pre√ßo Un.</th>
                                    <th>Total</th>
                                    <th>ROI</th>
                                </tr>
                            </thead>
                            <tbody class="player-list-body">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Mensagem de erro/aviso -->
                <div class="block-message" style="display: none;"></div>
            </div>
        </div>
    </template>

    <script src="js/app.js"></script>
    <script>
        document.getElementById('btnLogout').addEventListener('click', async () => {
            try {
                const response = await fetch('/logout', { method: 'POST' });
                if (response.ok) {
                    window.location.href = '/login.html';
                } else {
                    alert('Erro ao sair. Tente novamente.');
                }
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
                alert('Erro de conex√£o ao tentar sair.');
            }
        });
    </script>
</body>

</html>